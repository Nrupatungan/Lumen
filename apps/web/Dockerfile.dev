# ===========================================
# Development Dockerfile for Web (Next.js)
# ===========================================
FROM node:24 AS dev

RUN apt-get update && apt-get install -y git links2 && rm -rf /var/lib/apt/lists/*

RUN corepack enable && corepack prepare pnpm@latest-10 --activate

WORKDIR /app

# Copy only workspace metadata first
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml turbo.json ./

# Root dependencies first â†’ cacheable
ENV CI=true
RUN pnpm install --ignore-scripts

# Copy monorepo source code
COPY . .

# Now link everything
RUN pnpm install

CMD ["pnpm", "--filter", "web", "dev"]
